<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello, AR World! • A-Frame</title>
    <meta name="description" content="Hello, AR World! • A-Frame">
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent('follow-shadow', {
        schema: {type: 'selector'},
        init() {this.el.object3D.renderOrder = -1;},
        tick() {
          if (this.data) {
            this.el.object3D.position.copy(this.data.object3D.position);
            this.el.object3D.position.y-=0.001; // stop z-fighting
          }
        }
      });

      AFRAME.registerComponent('spawn-on-tap', {
        init: function() {
          console.log('spawn-on-tap component initialized');
          
          // Create debug text element
          this.debugText = document.createElement('div');
          this.debugText.style.position = 'fixed';
          this.debugText.style.top = '10px';
          this.debugText.style.left = '10px';
          this.debugText.style.color = 'white';
          this.debugText.style.backgroundColor = 'rgba(0,0,0,0.7)';
          this.debugText.style.padding = '10px';
          this.debugText.style.fontFamily = 'Arial';
          this.debugText.style.fontSize = '14px';
          this.debugText.style.zIndex = '9999';
          this.debugText.innerHTML = 'Waiting for tap...';
          document.body.appendChild(this.debugText);
          
          // Counter for taps
          this.tapCount = 0;
          
          this.el.addEventListener('ar-hit-test-select', (e) => {
            this.tapCount++;
            console.log('ar-hit-test-select event fired! Count:', this.tapCount);
            this.debugText.innerHTML = `Tap detected! Count: ${this.tapCount}<br>Position: ${e.detail.position.x.toFixed(2)}, ${e.detail.position.y.toFixed(2)}, ${e.detail.position.z.toFixed(2)}`;
            
            // Randomly choose between snowman and pine tree
            const random = Math.random();
            if (random < 0.5) {
              this.spawnSnowman(e);
              console.log('Spawning snowman');
            } else {
              this.spawnPineTree(e);
              console.log('Spawning pine tree');
            }
          });
          
          // Also listen for other events to debug
          this.el.addEventListener('ar-hit-test-start', () => {
            console.log('ar-hit-test-start event fired');
            this.debugText.innerHTML = 'AR Hit Test Started!';
          });
          
          this.el.addEventListener('ar-hit-test-achieved', () => {
            console.log('ar-hit-test-achieved event fired');
            this.debugText.innerHTML = 'AR Hit Test Achieved! Tap to spawn objects';
          });
        },
        
        spawnSnowman: function(event) {
          const objectsContainer = document.getElementById('objects');
          const newSnowman = document.createElement('a-entity');
          
          // Set position from hit test
          const pos = event.detail.position;
          newSnowman.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
          
          // Create snowman structure
          newSnowman.innerHTML = `
            <!-- Bottom sphere -->
            <a-sphere position="0 0.6 0" radius="0.6" color="#FFFFFF"></a-sphere>
            <!-- Middle sphere -->
            <a-sphere position="0 1.4 0" radius="0.45" color="#FFFFFF"></a-sphere>
            <!-- Head sphere -->
            <a-sphere position="0 2 0" radius="0.3" color="#FFFFFF"></a-sphere>
            <!-- Eyes -->
            <a-sphere position="-0.1 2.05 0.25" radius="0.05" color="#000000"></a-sphere>
            <a-sphere position="0.1 2.05 0.25" radius="0.05" color="#000000"></a-sphere>
            <!-- Carrot nose -->
            <a-cone position="0 1.95 0.35" radius-bottom="0.05" radius-top="0" height="0.2" rotation="90 0 0" color="#FF6347"></a-cone>
            <!-- Buttons -->
            <a-sphere position="0 1.5 0.42" radius="0.06" color="#000000"></a-sphere>
            <a-sphere position="0 1.3 0.43" radius="0.06" color="#000000"></a-sphere>
            <!-- Hat -->
            <a-cylinder position="0 2.4 0" radius="0.35" height="0.1" color="#000000"></a-cylinder>
            <a-cylinder position="0 2.7 0" radius="0.2" height="0.5" color="#000000"></a-cylinder>
          `;
          
          objectsContainer.appendChild(newSnowman);
        },
        
        spawnPineTree: function(event) {
          const objectsContainer = document.getElementById('objects');
          const newTree = document.createElement('a-entity');
          
          // Set position from hit test
          const pos = event.detail.position;
          newTree.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
          
          // Create pine tree structure
          newTree.innerHTML = `
            <!-- Trunk -->
            <a-cylinder position="0 0.3 0" radius="0.15" height="0.6" color="#8B4513"></a-cylinder>
            <!-- Bottom tier -->
            <a-cone position="0 0.8 0" radius-bottom="0.8" radius-top="0" height="1" color="#228B22"></a-cone>
            <!-- Middle tier -->
            <a-cone position="0 1.4 0" radius-bottom="0.6" radius-top="0" height="0.8" color="#2E8B57"></a-cone>
            <!-- Top tier -->
            <a-cone position="0 1.9 0" radius-bottom="0.4" radius-top="0" height="0.6" color="#32CD32"></a-cone>
            <!-- Star on top -->
            <a-octahedron position="0 2.3 0" radius="0.1" color="#FFD700"></a-octahedron>
          `;
          
          objectsContainer.appendChild(newTree);
        }
      });
    </script>
  </head>
  <body>
    <a-scene
      reflection="directionalLight: a-light[type=directional]"
      ar-hit-test="enabled: true;"
      spawn-on-tap
      renderer="colorManagement: true; exposure: 1; toneMapping: ACESFilmic"
      shadow="type: pcfsoft"
      xr-mode-ui="XRMode: xr"
    >
      <a-light type="directional" light="castShadow:true;" position="1 1 1" intensity="1.57" shadow-camera-automatic="#objects"></a-light>
      <a-camera position="0 0.4 0" wasd-controls="acceleration:10;"></a-camera>
      <a-entity id="objects" scale="0.15 0.15 0.15" position="0 0 -1" shadow>
        <!-- Snowman 1 -->
        <a-entity position="-2 0 0">
          <!-- Bottom sphere -->
          <a-sphere position="0 0.6 0" radius="0.6" color="#FFFFFF"></a-sphere>
          <!-- Middle sphere -->
          <a-sphere position="0 1.4 0" radius="0.45" color="#FFFFFF"></a-sphere>
          <!-- Head sphere -->
          <a-sphere position="0 2 0" radius="0.3" color="#FFFFFF"></a-sphere>
          <!-- Eyes -->
          <a-sphere position="-0.1 2.05 0.25" radius="0.05" color="#000000"></a-sphere>
          <a-sphere position="0.1 2.05 0.25" radius="0.05" color="#000000"></a-sphere>
          <!-- Carrot nose -->
          <a-cone position="0 1.95 0.35" radius-bottom="0.05" radius-top="0" height="0.2" rotation="90 0 0" color="#FF6347"></a-cone>
          <!-- Buttons -->
          <a-sphere position="0 1.5 0.42" radius="0.06" color="#000000"></a-sphere>
          <a-sphere position="0 1.3 0.43" radius="0.06" color="#000000"></a-sphere>
          <!-- Hat -->
          <a-cylinder position="0 2.4 0" radius="0.35" height="0.1" color="#000000"></a-cylinder>
          <a-cylinder position="0 2.7 0" radius="0.2" height="0.5" color="#000000"></a-cylinder>
        </a-entity>
        
        <!-- Pine Tree 1 -->
        <a-entity position="2 0 0">
          <!-- Trunk -->
          <a-cylinder position="0 0.3 0" radius="0.15" height="0.6" color="#8B4513"></a-cylinder>
          <!-- Bottom tier -->
          <a-cone position="0 0.8 0" radius-bottom="0.8" radius-top="0" height="1" color="#228B22"></a-cone>
          <!-- Middle tier -->
          <a-cone position="0 1.4 0" radius-bottom="0.6" radius-top="0" height="0.8" color="#2E8B57"></a-cone>
          <!-- Top tier -->
          <a-cone position="0 1.9 0" radius-bottom="0.4" radius-top="0" height="0.6" color="#32CD32"></a-cone>
          <!-- Star on top -->
          <a-octahedron position="0 2.3 0" radius="0.1" color="#FFD700"></a-octahedron>
        </a-entity>
        
        <!-- Pine Tree 2 -->
        <a-entity position="0 0 2">
          <!-- Trunk -->
          <a-cylinder position="0 0.25 0" radius="0.12" height="0.5" color="#8B4513"></a-cylinder>
          <!-- Bottom tier -->
          <a-cone position="0 0.7 0" radius-bottom="0.7" radius-top="0" height="0.9" color="#228B22"></a-cone>
          <!-- Middle tier -->
          <a-cone position="0 1.3 0" radius-bottom="0.5" radius-top="0" height="0.7" color="#2E8B57"></a-cone>
          <!-- Top tier -->
          <a-cone position="0 1.75 0" radius-bottom="0.35" radius-top="0" height="0.55" color="#32CD32"></a-cone>
          <!-- Star on top -->
          <a-octahedron position="0 2.15 0" radius="0.08" color="#FFD700"></a-octahedron>
        </a-entity>
        
        <!-- Snowman 2 -->
        <a-entity position="0 0 -2">
          <!-- Bottom sphere -->
          <a-sphere position="0 0.5 0" radius="0.5" color="#FFFFFF"></a-sphere>
          <!-- Middle sphere -->
          <a-sphere position="0 1.15 0" radius="0.38" color="#FFFFFF"></a-sphere>
          <!-- Head sphere -->
          <a-sphere position="0 1.65 0" radius="0.25" color="#FFFFFF"></a-sphere>
          <!-- Eyes -->
          <a-sphere position="-0.08 1.7 0.22" radius="0.04" color="#000000"></a-sphere>
          <a-sphere position="0.08 1.7 0.22" radius="0.04" color="#000000"></a-sphere>
          <!-- Carrot nose -->
          <a-cone position="0 1.62 0.28" radius-bottom="0.04" radius-top="0" height="0.18" rotation="90 0 0" color="#FF6347"></a-cone>
          <!-- Buttons -->
          <a-sphere position="0 1.25 0.35" radius="0.05" color="#000000"></a-sphere>
          <a-sphere position="0 1.08 0.36" radius="0.05" color="#000000"></a-sphere>
          <!-- Hat -->
          <a-cylinder position="0 1.98 0" radius="0.28" height="0.08" color="#000000"></a-cylinder>
          <a-cylinder position="0 2.22 0" radius="0.17" height="0.4" color="#000000"></a-cylinder>
        </a-entity>
      </a-entity>
      <a-plane follow-shadow="#objects" material="shader:shadow" shadow="cast:false;" rotation="-90 0 0" width="2" height="2"></a-plane>
      <a-sky color="#87CEEB" hide-on-enter-ar></a-sky>
    </a-scene>
  </body>
</html>
