<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Spawner â€“ Snowman & Tree</title>

    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-ar@3.4.0/dist/aframe-ar.min.js"></script>

    <style>
      #toggleBtn {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 18px;
        font-size: 16px;
        border-radius: 8px;
        border: none;
        background: #222;
        color: white;
        z-index: 999;
      }
    </style>

    <script>
      AFRAME.registerComponent('tap-spawner', {
        schema: { mode: { default: 'snowman' } },

        init() {
          this.el.sceneEl.addEventListener('click', () => this.spawn());
          window.toggleSpawnMode = () => this.toggle();
        },

        toggle() {
          this.data.mode = this.data.mode === 'snowman' ? 'tree' : 'snowman';
          document.getElementById('toggleBtn').innerText =
            `Spawn: ${this.data.mode === 'snowman' ? 'Snowman â›„' : 'Tree ðŸŒ²'}`;
        },

        spawn() {
          const hitTest = this.el.sceneEl.components['ar-hit-test'];
          if (!hitTest || !hitTest.lastHit) return;

          const { position, rotation } = hitTest.lastHit;

          const template =
            this.data.mode === 'tree'
              ? document.querySelector('#tree-template')
              : document.querySelector('#snowman-template');

          const wrapper = document.createElement('a-entity');
          wrapper.setAttribute('position', position);
          wrapper.setAttribute('rotation', rotation);
          wrapper.setAttribute('scale', '0.15 0.15 0.15');
          wrapper.setAttribute('shadow', '');

          wrapper.appendChild(template.cloneNode(true));
          this.el.sceneEl.appendChild(wrapper);
        }
      });
    </script>
  </head>

  <body>
    <!-- Toggle Button -->
    <button id="toggleBtn" onclick="toggleSpawnMode()">
      Spawn: Snowman â›„
    </button>

    <a-scene
      tap-spawner
      ar-hit-test
      renderer="colorManagement: true; exposure: 1"
      shadow="type: pcfsoft"
      xr-mode-ui="XRMode: xr">

      <!-- Lighting -->
      <a-light type="directional" castshadow intensity="1.5" position="1 2 1"></a-light>
      <a-light type="ambient" intensity="0.4"></a-light>

      <a-camera position="0 0.4 0"></a-camera>

      <!-- Templates -->
      <a-assets>
        <!-- Snowman -->
        <a-entity id="snowman-template">
          <a-sphere position="0 0.6 0" radius="0.6" color="#FFF"></a-sphere>
          <a-sphere position="0 1.4 0" radius="0.45" color="#FFF"></a-sphere>
          <a-sphere position="0 2 0" radius="0.3" color="#FFF"></a-sphere>
          <a-sphere position="-0.1 2.05 0.25" radius="0.05" color="#000"></a-sphere>
          <a-sphere position="0.1 2.05 0.25" radius="0.05" color="#000"></a-sphere>
          <a-cone position="0 1.95 0.35" radius-bottom="0.05" radius-top="0"
                  height="0.2" rotation="90 0 0" color="#FF6347"></a-cone>
          <a-cylinder position="0 2.4 0" radius="0.35" height="0.1" color="#000"></a-cylinder>
          <a-cylinder position="0 2.7 0" radius="0.2" height="0.5" color="#000"></a-cylinder>
        </a-entity>

        <!-- Pine Tree -->
        <a-entity id="tree-template">
          <a-cylinder position="0 0.3 0" radius="0.15" height="0.6" color="#8B4513"></a-cylinder>
          <a-cone position="0 0.8 0" radius-bottom="0.8" radius-top="0" height="1" color="#228B22"></a-cone>
          <a-cone position="0 1.4 0" radius-bottom="0.6" radius-top="0" height="0.8" color="#2E8B57"></a-cone>
          <a-cone position="0 1.9 0" radius-bottom="0.4" radius-top="0" height="0.6" color="#32CD32"></a-cone>
          <a-octahedron position="0 2.3 0" radius="0.1" color="#FFD700"></a-octahedron>
        </a-entity>
      </a-assets>

      <!-- Shadow receiver -->
      <a-plane rotation="-90 0 0" width="5" height="5"
               material="shader:shadow" shadow="receive: true"></a-plane>

      <a-sky color="#87CEEB" hide-on-enter-ar></a-sky>
    </a-scene>
  </body>
</html>
